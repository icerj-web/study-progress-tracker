<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Study Tracker - Login & Signup</title>
<style>
  body {
    font-family: Arial, sans-serif; background: #f5f7fa; margin:0; min-height:100vh; display: flex; justify-content: center; align-items: center;
  }
  .container {
    background: white;
    padding: 25px 30px;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
    max-width: 400px;
    width: 100%;
    text-align: center;
  }
  h2 {
    color: #004aad;
  }
  input[type=text], input[type=password] {
    width: 100%;
    padding: 10px 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
  }
  button {
    width: 100%;
    background: #004aad;
    color: white;
    border: none;
    padding: 12px;
    font-weight: 700;
    font-size: 16px;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover {
    background: #00337f;
  }
  .switch-auth {
    margin-top: 15px;
    color: #004aad;
    cursor: pointer;
    text-decoration: underline;
  }
  #logout-btn, #delete-account-btn {
    margin: 10px 0 0 0;
    background: #e53935;
  }
  #logout-btn:hover, #delete-account-btn:hover {
    background: #ab000d;
  }
  #welcome-msg {
    font-weight: 600;
    margin-bottom: 20px;
    color: #333;
  }
  #role-selection {
    margin-top: 20px;
    text-align: left;
  }
  #role-selection h3 {
    color: #004aad;
    margin-bottom: 10px;
  }
  #role-selection p {
    color: #555;
  }
</style>
</head>
<body>

<div class="container" id="auth-container">
  <h2 id="form-title">Login</h2>
  <input type="text" id="username" placeholder="Username" autocomplete="username" />
  <input type="password" id="password" placeholder="Password" autocomplete="current-password" />
  <button id="submit-btn">Login</button>
  <div class="switch-auth" id="toggle-auth">Don't have an account? Sign up</div>
</div>

<div class="container" id="app-container" style="display:none;">
  <div id="welcome-msg"></div>
  <button id="logout-btn">Logout</button>
  <button id="delete-account-btn">Delete Account</button>

  <div id="role-selection">
    <h3>Role Selection</h3>
    <p>This section will show your roles and allow selection after next steps.</p>
  </div>
</div>

<script>
  // Predefine admin user (username: admin, password: Admin@123)
  const predefinedUsers = {
    admin: { password: hashPassword("Admin@123"), data: { roles: [] } }
  };

  // Load or initialize users in localStorage
  function loadUsers() {
    let stored = localStorage.getItem("users");
    if(!stored) {
      localStorage.setItem("users", JSON.stringify(predefinedUsers));
      return {...predefinedUsers};
    }
    return JSON.parse(stored);
  }

  let users = loadUsers();
  let currentUser = null;

  const authContainer = document.getElementById("auth-container");
  const appContainer = document.getElementById("app-container");

  const formTitle = document.getElementById("form-title");
  const usernameInput = document.getElementById("username");
  const passwordInput = document.getElementById("password");
  const submitBtn = document.getElementById("submit-btn");
  const toggleAuth = document.getElementById("toggle-auth");

  const welcomeMsg = document.getElementById("welcome-msg");
  const logoutBtn = document.getElementById("logout-btn");
  const deleteAccountBtn = document.getElementById("delete-account-btn");

  let isLogin = true; // toggle between login/signup

  // Simple hash function (NOT SECURE, just for demo)
  function hashPassword(str) {
    let hash = 0, i, chr;
    if (str.length === 0) return hash.toString();
    for (i = 0; i < str.length; i++) {
      chr = str.charCodeAt(i);
      hash = ((hash << 5) - hash) + chr;
      hash |= 0; // Convert to 32bit integer
    }
    return hash.toString();
  }

  // Switch between login and signup UI
  toggleAuth.addEventListener("click", () => {
    isLogin = !isLogin;
    formTitle.textContent = isLogin ? "Login" : "Sign Up";
    submitBtn.textContent = isLogin ? "Login" : "Sign Up";
    toggleAuth.textContent = isLogin ? "Don't have an account? Sign up" : "Already have an account? Login";
    usernameInput.value = "";
    passwordInput.value = "";
  });

  // Handle login/signup button click
  submitBtn.addEventListener("click", () => {
    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();

    if(!username || !password){
      alert("Please enter username and password.");
      return;
    }

    if (isLogin){
      // Login flow
      if(users[username] && users[username].password === hashPassword(password)){
        currentUser = username;
        sessionStorage.setItem("currentUser", currentUser);
        showApp();
      } else {
        alert("Invalid username or password.");
      }
    } else {
      // Signup flow
      if(users[username]){
        alert("Username already exists. Choose another.");
        return;
      }
      users[username] = {password: hashPassword(password), data: {roles: []}};
      localStorage.setItem("users", JSON.stringify(users));
      alert("Account created! You can now login.");
      isLogin = true;
      formTitle.textContent = "Login";
      submitBtn.textContent = "Login";
      toggleAuth.textContent = "Don't have an account? Sign up";
      usernameInput.value = "";
      passwordInput.value = "";
    }
  });

  // Show main app after login
  function showApp() {
    authContainer.style.display = "none";
    appContainer.style.display = "block";
    welcomeMsg.textContent = "Welcome, " + currentUser + "!";
  }

  // Logout action
  logoutBtn.addEventListener("click", () => {
    currentUser = null;
    sessionStorage.removeItem("currentUser");
    authContainer.style.display = "block";
    appContainer.style.display = "none";
    usernameInput.value = "";
    passwordInput.value = "";
  });

  // Delete account action with confirmation
  deleteAccountBtn.addEventListener("click", () => {
    if(confirm("Are you sure you want to delete your account? This action cannot be undone.")){
      if(users[currentUser]){
        delete users[currentUser];
        localStorage.setItem("users", JSON.stringify(users));
        logoutBtn.click();
        alert("Your account has been deleted.");
      }
    }
  });

  // On page load, check session
  window.onload = () => {
    const savedUser = sessionStorage.getItem("currentUser");
    if(savedUser && users[savedUser]){
      currentUser = savedUser;
      showApp();
    }
  };
</script>

</body>
</html>
